<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:GarageVelo.ViewModels"
    xmlns:models="clr-namespace:GarageVelo.Models"
    x:Class="GarageVelo.Views.GarageDetailPage"
    x:DataType="vm:GarageDetailViewModel"
    Title="{Binding Title}"
    BackgroundColor="{StaticResource Surface}">

    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="16">

            <!-- Location banner (replaces map) -->
            <Frame Style="{StaticResource CardFrame}" Padding="20" BackgroundColor="{StaticResource Primary}">
                <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                    <Label
                        Text="Localisation"
                        TextColor="{StaticResource White}"
                        FontSize="14"
                        HorizontalOptions="Center" />
                    <Label
                        Text="{Binding Garage.Address}"
                        TextColor="{StaticResource White}"
                        FontSize="16"
                        FontAttributes="Bold"
                        HorizontalOptions="Center"
                        HorizontalTextAlignment="Center" />
                    <Label
                        TextColor="{StaticResource Accent}"
                        FontSize="12"
                        HorizontalOptions="Center">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="{Binding Garage.Latitude, StringFormat='{0:F4}'}" />
                                <Span Text=", " />
                                <Span Text="{Binding Garage.Longitude, StringFormat='{0:F4}'}" />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </VerticalStackLayout>
            </Frame>

            <!-- Garage info card -->
            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="12" x:DataType="vm:GarageDetailViewModel">

                    <Label
                        Text="{Binding Garage.Name}"
                        Style="{StaticResource TitleLabel}"
                        FontSize="24"
                        TextColor="{StaticResource Primary}" />

                    <Label
                        Text="{Binding Garage.Address}"
                        Style="{StaticResource SubtitleLabel}" />

                    <BoxView HeightRequest="1" Color="{StaticResource Divider}" />

                    <!-- Details grid -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="16" RowSpacing="12">

                        <VerticalStackLayout Grid.Row="0" Grid.Column="0">
                            <Label Text="Taille" Style="{StaticResource SubtitleLabel}" FontSize="12" />
                            <Label Text="{Binding Garage.Size}" FontAttributes="Bold" FontSize="16" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="0" Grid.Column="1">
                            <Label Text="Position" Style="{StaticResource SubtitleLabel}" FontSize="12" />
                            <Label Text="{Binding Garage.Position, StringFormat='Place {0}'}" FontAttributes="Bold" FontSize="16" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="1" Grid.Column="0">
                            <Label Text="Places totales" Style="{StaticResource SubtitleLabel}" FontSize="12" />
                            <Label Text="{Binding Garage.TotalSlots}" FontAttributes="Bold" FontSize="16" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="1" Grid.Column="1">
                            <Label Text="Disponibles" Style="{StaticResource SubtitleLabel}" FontSize="12" />
                            <Label Text="{Binding Garage.AvailableSlots}" FontAttributes="Bold" FontSize="16" TextColor="{StaticResource Success}" />
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Error message -->
            <Label
                Text="{Binding ErrorMessage}"
                TextColor="{StaticResource Error}"
                IsVisible="{Binding ErrorMessage, Converter={StaticResource IsStringNotNullOrWhiteSpaceConverter}}"
                HorizontalOptions="Center" />

            <!-- Loading -->
            <ActivityIndicator
                IsRunning="{Binding IsBusy}"
                IsVisible="{Binding IsBusy}"
                HorizontalOptions="Center" />

            <!-- Subscribe button -->
            <Button
                Text="S'abonner"
                Style="{StaticResource CTAButton}"
                Command="{Binding GoToSubscriptionCommand}"
                Margin="0,8,0,0" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
